<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QESG - Insights & News</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        :root {
            /* Common Theme */
            --bg-body: #ffffff;
            --novo-navy: #001952;      
            --novo-blue: #f0f7ff;      
            --text-body: #475569;      
            --gradient-esg: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        
        body { 
            background: var(--bg-body); color: var(--novo-navy); line-height: 1.6; overflow-x: hidden;
            scroll-behavior: smooth;
        }

        a { text-decoration: none; color: inherit; transition: 0.3s; }
        img { display: block; max-width: 100%; height: auto; }
        ul { list-style: none; padding: 0; margin: 0; }

        /* [Header - Index Style] */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000;
            padding: 16px 40px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo img { height: 42px; } /* 로고 크기 통일 */
        
        .header-right { display: flex; align-items: center; gap: 40px; }
        .gnb { display: flex; gap: 24px; align-items: center; }
        .nav-link { font-size: 16px; font-weight: 600; color: var(--text-body); position: relative; }
        .nav-link:hover, .nav-link.active { color: var(--novo-navy); }
        /* Blog Active Style */
        .nav-link.active::after {
            content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: #2563eb; border-radius: 50%;
        }

        .action-group { display: flex; align-items: center; gap: 12px; padding-left: 20px; border-left: 1px solid #e2e8f0; }
        .btn-back { font-size: 14px; font-weight: 600; color: var(--text-body); display: flex; align-items: center; gap: 4px; cursor: pointer; }
        .btn-back:hover { color: var(--novo-navy); }

        /* [Blog Hero] */
        .blog-hero {
            padding: 180px 40px 100px;
            background: var(--novo-blue);
            text-align: center;
        }
        .blog-hero h1 { font-size: 56px; font-weight: 800; margin-bottom: 20px; letter-spacing: -2px; color: var(--novo-navy); }
        .blog-hero p { font-size: 18px; color: var(--text-body); max-width: 600px; margin: 0 auto; }

        /* [Filter Chips] */
        .filter-container {
            display: flex; justify-content: center; gap: 12px; margin-top: 40px;
        }
        .chip {
            padding: 8px 24px; border-radius: 50px; background: white;
            border: 1px solid #e2e8f0; font-size: 14px; font-weight: 600;
            cursor: pointer; transition: 0.3s;
        }
        .chip.active, .chip:hover {
            background: var(--novo-navy); color: white; border-color: var(--novo-navy);
        }

        /* [Main Feed] */
        .blog-feed {
            max-width: 1400px; margin: 80px auto; padding: 0 40px;
            display: grid; grid-template-columns: repeat(3, 1fr); /* 3열 배치 (한 줄에 3개) */
            gap: 30px;
            min-height: 500px;
        }

        .post-card {
            position: relative; border-radius: 20px; overflow: hidden;
            background: #fff; color: var(--novo-navy); 
            border: 1px solid #e2e8f0; cursor: pointer; 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex; flex-direction: column;
            height: 420px; /* 카드 높이 고정 */
        }
        .post-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }

        .post-img-wrap {
            height: 220px; overflow: hidden; background: #f1f5f9;
        }
        .post-img {
            width: 100%; height: 100%; object-fit: cover;
            transition: 0.5s ease;
        }
        .post-card:hover .post-img { transform: scale(1.05); }

        .post-content {
            padding: 24px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;
        }
        .post-tag {
            display: inline-block; padding: 4px 10px; border-radius: 4px;
            background: #f1f5f9; color: var(--text-body); 
            font-size: 12px; font-weight: 700; margin-bottom: 12px; width: fit-content;
        }
        .post-title { 
            font-size: 18px; font-weight: 700; line-height: 1.4; margin-bottom: 10px; 
            overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
        }
        .post-date { font-size: 13px; color: #94a3b8; margin-top: auto; }

        /* [Pagination] */
        .pagination {
            display: flex; justify-content: center; gap: 8px; margin-bottom: 100px;
        }
        .page-btn {
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            border-radius: 8px; border: 1px solid #e2e8f0; background: white;
            cursor: pointer; font-weight: 600; color: var(--text-body); transition: 0.3s;
        }
        .page-btn:hover { background: #f8fafc; }
        .page-btn.active { background: var(--novo-navy); color: white; border-color: var(--novo-navy); }
        .page-btn.disabled { opacity: 0.5; cursor: default; }

        /* [Footer - Index Style] */
        footer { padding: 80px 40px; background: #f8f9fa; border-top: 1px solid #e2e8f0; }
        .footer-inner { max-width: 1400px; margin: 0 auto; }
        .footer-logo img { height: 32px; margin-bottom: 24px; opacity: 0.9; }
        
        .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 40px; }
        
        .company-info { font-size: 15px; color: var(--text-body); line-height: 1.8; text-align: left; }
        .company-info strong { color: var(--novo-navy); font-weight: 700; }
        .footer-right { text-align: right; display: flex; flex-direction: column; justify-content: flex-end; }
        .footer-links a { font-size: 15px; font-weight: 600; color: var(--novo-navy); margin-left: 20px; text-decoration: none; }
        .footer-links a:hover { text-decoration: underline; color: #2563eb; }
        .copyright { color: #94a3b8; font-size: 14px; }

        /* 반응형 */
        @media (max-width: 1024px) {
            .blog-feed { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            /* Header */
            header { padding: 12px 20px; }
            .header-right { gap: 15px; }
            .gnb { display: none; }
            .action-group { padding-left: 0; border-left: none; }
            .btn-back { display: none; } /* 모바일에서 Back 버튼 숨김 */

            .blog-feed { grid-template-columns: 1fr; }
            
            /* Footer */
            .footer-content { flex-direction: column; gap: 30px; }
            .footer-right { text-align: left; align-items: flex-start; }
            .footer-links a { margin-left: 0; margin-right: 15px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <a href="index.html">
                <img src="https://qesg.co.kr/images/qesg.svg" alt="QESG">
            </a>
        </div>
        
        <div class="header-right">
            <nav class="gnb">
                <a href="ert.html" class="nav-link">ERT Reporting</a>
                <a href="dms.html" class="nav-link">DMS Data Hub</a>
                <a href="supply.html" class="nav-link">Supply Chain</a>
                <a href="carbon.html" class="nav-link">Carbon Mgmt</a>
                <a href="blog.html" class="nav-link active">Blog</a>
            </nav>
            <div class="action-group">
                <a href="index.html" class="btn-back"><i class="ph ph-arrow-left"></i> 메인으로</a>
            </div>
        </div>
    </header>

    <section class="blog-hero">
        <span style="color: #2563eb; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;">News & Insights</span>
        <h1>ESG Tech Blog</h1>
        <p>퀀티파이드이에스지의 전문가들이 전하는<br>글로벌 ESG 규제 대응 전략과 최신 기술 동향을 확인하세요.</p>
        
        <div class="filter-container">
            <div class="chip active" onclick="filterCategory('All')">All</div>
            <div class="chip" onclick="filterCategory('Insight')">Insight</div>
            <div class="chip" onclick="filterCategory('Career')">Career</div>
        </div>
    </section>

    <main class="blog-feed" id="blog-container">
        <p style="grid-column: span 3; text-align: center; color: #999; padding: 50px;">
            Loading News...
        </p>
    </main>

    <div class="pagination" id="pagination-container"></div>

    <footer>
        <div class="footer-inner">
            <div class="footer-content">
                <div class="footer-left">
                    <div class="footer-logo"><img src="https://qesg.co.kr/images/qesg.svg" alt="QESG"></div>
                    <div class="company-info">
                        <strong>(주)퀀티파이드이에스지</strong><br>
                        대표: 배익현 &nbsp;|&nbsp; 사업자등록번호: 349-86-01679<br>
                        주소: 서울특별시 종로구 새문안로3길 12 (신문로1가, 신문로빌딩), 3층 퀀티파이드이에스지<br>
                        문의: <a href="mailto:info@qesg.co.kr">info@qesg.co.kr</a>
                    </div>
                </div>
                
                <div class="footer-right">
                    <div class="footer-links">
                        <a href="https://qesg.co.kr/terms/privacy_policy/" target="_blank">개인정보처리방침</a>
                        <a href="https://qesg.co.kr/terms/terms_of_use/" target="_blank">이용약관</a>
                    </div>
                    <div class="copyright">
                        Copyright © 2026 QuantifiedESG, Inc. All Rights Reserved
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let allArticles = [];     // 전체 글 저장
        let currentCategory = 'All';
        let currentPage = 1;
        const itemsPerPage = 9;   // 2. 한 페이지당 9개 (3열 x 3줄)

        document.addEventListener("DOMContentLoaded", function() {
            fetchNewsData();
        });

        async function fetchNewsData() {
            const container = document.getElementById('blog-container');
            const apiUrl = 'https://cms.dataflare.net/api/qe_read_article_list'; 

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const rawData = await response.json();
                
                // 데이터가 객체 안에 list로 들어있거나, 바로 배열일 수 있음
                const articles = Array.isArray(rawData) ? rawData : (rawData.list || rawData.data || []);
                
                allArticles = articles; // 전체 데이터 저장
                renderPage(1);          // 첫 페이지 렌더링

            } catch (error) {
                console.error("데이터 로딩 실패:", error);
                container.innerHTML = '<p style="grid-column: span 3; text-align:center; color:red;">뉴스 데이터를 불러오지 못했습니다.</p>';
            }
        }

        // 카테고리 필터링 함수
        function filterCategory(category) {
            currentCategory = category;
            currentPage = 1;
            
            // 칩 스타일 업데이트
            document.querySelectorAll('.chip').forEach(el => {
                el.classList.toggle('active', el.innerText === category);
            });
            
            renderPage(1);
        }

        // 페이지 렌더링 함수
        function renderPage(page) {
            currentPage = page;
            const container = document.getElementById('blog-container');
            container.innerHTML = '';

            // 1. 카테고리 필터링 (임의 로직: 실제 데이터에 카테고리 필드가 없다면 'Insight'로 가정)
            // *실제로는 API 데이터에 'category' 필드가 있어야 정확합니다. 
            // 여기서는 편의상 모든 글을 보여주되, 키워드로 필터링하는 시늉만 냅니다.
            let filtered = allArticles;
            if (currentCategory !== 'All') {
                // 예: 제목에 '채용'이 있으면 Career, 아니면 Insight (데이터 구조에 따라 수정 필요)
                filtered = allArticles.filter(item => {
                    if(currentCategory === 'Career') return (item.title && item.title.includes('채용'));
                    return true; // Insight는 나머지 전부
                });
            }

            // 2. 페이지네이션 계산
            const totalItems = filtered.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filtered.slice(start, end);

            if (pageData.length === 0) {
                container.innerHTML = '<p style="grid-column: span 3; text-align:center;">게시글이 없습니다.</p>';
                document.getElementById('pagination-container').innerHTML = '';
                return;
            }

            // 3. 카드 생성
            pageData.forEach(item => {
                const title = item.title || '제목 없음';
                
                // 날짜 포맷팅
                let dateStr = item.created_at || item.reg_date || item.date || '2025.01.01';
                if (dateStr.length > 10) dateStr = dateStr.substring(0, 10);

                // 1. 이미지 주소 처리 (상대경로인 경우 도메인 붙이기)
                let imgUrl = item.thumbnail_url || item.file_url || '';
                if (!imgUrl) {
                    imgUrl = 'https://via.placeholder.com/800x600?text=QESG+News'; // 기본 이미지
                } else if (!imgUrl.startsWith('http')) {
                    imgUrl = 'https://qesg.co.kr' + imgUrl; // 도메인 연결
                }

                // 3. 상세 링크 (새 탭으로 열기 위해 _blank 사용)
                // 우리가 만들 view.html로 이동 (article_code를 꼬리표로 달고 감)
const linkUrl = `view.html?code=${item.article_code}`;

                // 카테고리 태그 (필터와 매칭)
                const displayTag = item.title.includes('채용') ? 'Career' : 'Insight';

                const cardHtml = `
                    <article class="post-card" onclick="window.open('${linkUrl}', '_blank')">
                        <div class="post-img-wrap">
                            <img src="${imgUrl}" alt="${title}" class="post-img" onerror="this.src='https://via.placeholder.com/800x600?text=No+Image'">
                        </div>
                        <div class="post-content">
                            <div>
                                <span class="post-tag">${displayTag}</span>
                                <h2 class="post-title">${title}</h2>
                            </div>
                            <p class="post-date">${dateStr}</p>
                        </div>
                    </article>
                `;
                container.insertAdjacentHTML('beforeend', cardHtml);
            });

            // 4. 페이지네이션 버튼 그리기
            renderPagination(totalPages);
        }

        function renderPagination(totalPages) {
            const paginationContainer = document.getElementById('pagination-container');
            paginationContainer.innerHTML = '';

            if (totalPages <= 1) return;

            // 이전 버튼
            const prevBtn = document.createElement('div');
            prevBtn.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
            prevBtn.innerHTML = '<i class="ph ph-caret-left"></i>';
            prevBtn.onclick = () => { if (currentPage > 1) renderPage(currentPage - 1); };
            paginationContainer.appendChild(prevBtn);

            // 숫자 버튼
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('div');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => renderPage(i);
                paginationContainer.appendChild(btn);
            }

            // 다음 버튼
            const nextBtn = document.createElement('div');
            nextBtn.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
            nextBtn.innerHTML = '<i class="ph ph-caret-right"></i>';
            nextBtn.onclick = () => { if (currentPage < totalPages) renderPage(currentPage + 1); };
            paginationContainer.appendChild(nextBtn);
        }
    </script>

</body>
</html>